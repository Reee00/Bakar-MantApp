<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Bakar Mantap - Pesan Nasi Bakar Asli Indonesia Online"
    />
    <meta name="theme-color" content="#ff6b35" />
    <title>Bakar Mantap - Nasi Bakar Asli Indonesia</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <link
      rel="icon"
      type="image/png"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî•</text></svg>"
    />

    <style>
      :root {
        --primary-color: #ff6b35;
        --primary-dark: #e55a2b;
        --secondary-color: #f7931e;
        --text-dark: #333;
        --text-light: #666;
        --text-muted: #999;
        --bg-light: #f8f9fa;
        --border-color: #ddd;
        --success-color: #4caf50;
        --error-color: #f44336;
        --warning-color: #ff9800;
        --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.15);
        --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.3);
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .phone-container {
        width: 375px;
        height: 812px;
        background: #000;
        border-radius: 40px;
        padding: 8px;
        box-shadow: var(--shadow-lg);
        position: relative;
      }

      .screen {
        width: 100%;
        height: 100%;
        background: #fff;
        border-radius: 32px;
        overflow: hidden;
        position: relative;
      }

      .status-bar {
        height: 44px;
        background: #fff;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
        font-size: 14px;
        font-weight: 600;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .page {
        display: none;
        height: calc(100% - 44px);
        overflow-y: auto;
        overflow-x: hidden;
      }

      .page.active {
        display: block;
      }

      /* Loading Spinner */
      .spinner {
        border: 3px solid rgba(255, 107, 53, 0.1);
        border-top: 3px solid var(--primary-color);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        backdrop-filter: blur(5px);
      }

      .loading-text {
        margin-top: 15px;
        color: var(--text-dark);
        font-weight: 600;
      }

      /* Splash Screen */
      .splash {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: white;
        padding: 40px;
      }

      .logo {
        width: 120px;
        height: 120px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        margin-bottom: 30px;
        backdrop-filter: blur(10px);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .app-title {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .tagline {
        font-size: 16px;
        opacity: 0.9;
        margin-bottom: 40px;
      }

      .get-started-btn {
        background: white;
        color: var(--primary-color);
        padding: 15px 40px;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }

      .get-started-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .skip-btn {
        position: absolute;
        top: 60px;
        right: 30px;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        backdrop-filter: blur(10px);
      }

      /* Home Screen */
      .home-header {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--secondary-color) 100%
        );
        padding: 20px;
        color: white;
      }

      .header-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .location {
        display: flex;
        align-items: center;
        font-size: 14px;
        cursor: pointer;
        transition: var(--transition);
      }

      .location:hover {
        opacity: 0.8;
      }

      .location::before {
        content: "üìç";
        margin-right: 5px;
      }

      .header-icons {
        display: flex;
        gap: 15px;
      }

      .icon-btn {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        border-radius: 20px;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: var(--transition);
        position: relative;
      }

      .icon-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      .welcome-text {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .subtitle {
        font-size: 14px;
        opacity: 0.9;
      }

      .search-bar {
        margin: 20px;
        position: relative;
      }

      .search-input {
        width: 100%;
        padding: 15px 50px 15px 45px;
        border: 1px solid var(--border-color);
        border-radius: 25px;
        font-size: 16px;
        background: var(--bg-light);
        transition: var(--transition);
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }

      .search-icon {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        pointer-events: none;
      }

      .clear-search {
        position: absolute;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        background: var(--text-muted);
        color: white;
        border: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 12px;
        display: none;
        align-items: center;
        justify-content: center;
      }

      .clear-search.active {
        display: flex;
      }

      .quick-actions {
        padding: 0 20px 20px;
      }

      .section-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--text-dark);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .view-all {
        font-size: 14px;
        color: var(--primary-color);
        cursor: pointer;
        font-weight: 500;
      }

      .action-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }

      .action-card {
        background: white;
        padding: 20px;
        border-radius: 15px;
        text-align: center;
        box-shadow: var(--shadow-sm);
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .action-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          var(--primary-color),
          var(--secondary-color)
        );
        transform: translateX(-100%);
        transition: var(--transition);
      }

      .action-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
      }

      .action-card:hover::before {
        transform: translateX(0);
      }

      .action-icon {
        font-size: 30px;
        margin-bottom: 10px;
      }

      .action-title {
        font-weight: 600;
        color: var(--text-dark);
      }

      .action-subtitle {
        font-size: 12px;
        color: var(--text-muted);
        margin-top: 5px;
      }

      /* Menu Screen */
      .menu-header {
        background: white;
        padding: 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        align-items: center;
        gap: 15px;
        position: sticky;
        top: 0;
        z-index: 50;
      }

      .back-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--primary-color);
        transition: var(--transition);
      }

      .back-btn:hover {
        transform: translateX(-3px);
      }

      .menu-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-dark);
        flex: 1;
      }

      .filter-toggle {
        background: none;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        width: 40px;
        height: 40px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .menu-categories {
        display: flex;
        padding: 15px 20px;
        gap: 10px;
        overflow-x: auto;
        border-bottom: 1px solid #eee;
        position: sticky;
        top: 80px;
        background: white;
        z-index: 49;
        scrollbar-width: none;
      }

      .menu-categories::-webkit-scrollbar {
        display: none;
      }

      .category-btn {
        padding: 10px 20px;
        border: 2px solid var(--primary-color);
        border-radius: 25px;
        background: white;
        color: var(--primary-color);
        font-weight: 600;
        cursor: pointer;
        white-space: nowrap;
        transition: var(--transition);
        flex-shrink: 0;
      }

      .category-btn:hover {
        background: rgba(255, 107, 53, 0.1);
      }

      .category-btn.active {
        background: var(--primary-color);
        color: white;
      }

      .menu-items {
        padding: 20px;
      }

      .menu-item {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: var(--shadow-sm);
        display: flex;
        gap: 15px;
        cursor: pointer;
        transition: var(--transition);
        opacity: 1;
      }

      .menu-item.hidden {
        display: none;
      }

      .menu-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .item-image {
        width: 80px;
        height: 80px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        color: white;
        flex-shrink: 0;
      }

      .item-info {
        flex: 1;
        min-width: 0;
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 5px;
      }

      .item-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-dark);
      }

      .favorite-btn {
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        padding: 0;
        line-height: 1;
        transition: var(--transition);
      }

      .favorite-btn:hover {
        transform: scale(1.2);
      }

      .item-description {
        font-size: 12px;
        color: var(--text-light);
        margin-bottom: 8px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .item-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .item-price {
        font-size: 16px;
        font-weight: 600;
        color: var(--primary-color);
      }

      .spice-level {
        display: flex;
        gap: 2px;
        margin-bottom: 5px;
      }

      .chili {
        color: #ff4444;
        font-size: 12px;
      }

      .add-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 17.5px;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
      }

      .add-btn:hover {
        background: var(--primary-dark);
        transform: scale(1.1);
      }

      .add-btn:active {
        transform: scale(0.95);
      }

      .empty-state {
        text-align: center;
        padding: 60px 40px;
        color: var(--text-muted);
      }

      .empty-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 10px;
      }

      .empty-message {
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 20px;
      }

      /* Product Detail */
      .product-detail {
        background: white;
      }

      .product-image-container {
        height: 300px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .product-image-large {
        font-size: 120px;
        color: white;
        animation: float 3s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .back-btn-detail {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 20px;
        color: white;
        font-size: 20px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .back-btn-detail:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      .favorite-btn-detail {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.2);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 20px;
        font-size: 20px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .favorite-btn-detail:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
      }

      .product-info {
        padding: 30px 20px 100px;
      }

      .product-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
      }

      .product-name {
        font-size: 24px;
        font-weight: bold;
        color: var(--text-dark);
        flex: 1;
      }

      .product-price {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 15px;
      }

      .product-rating {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      .stars {
        color: #ffc107;
      }

      .rating-text {
        font-size: 14px;
        color: var(--text-light);
      }

      .product-description {
        color: var(--text-light);
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .product-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 20px;
      }

      .tag {
        background: var(--bg-light);
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        color: var(--text-light);
      }

      .customization {
        margin-bottom: 25px;
      }

      .custom-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--text-dark);
      }

      .spice-options {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .spice-option {
        padding: 10px 18px;
        border: 2px solid var(--border-color);
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        transition: var(--transition);
        user-select: none;
      }

      .spice-option:hover {
        border-color: var(--primary-color);
        background: rgba(255, 107, 53, 0.05);
      }

      .spice-option.selected {
        border-color: var(--primary-color);
        background: var(--primary-color);
        color: white;
      }

      .quantity-selector {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 25px;
        margin-bottom: 25px;
        padding: 20px;
        background: var(--bg-light);
        border-radius: 15px;
      }

      .qty-btn {
        width: 45px;
        height: 45px;
        border: 2px solid var(--primary-color);
        background: white;
        color: var(--primary-color);
        border-radius: 22.5px;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-weight: bold;
      }

      .qty-btn:hover:not(:disabled) {
        background: var(--primary-color);
        color: white;
        transform: scale(1.05);
      }

      .qty-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
      }

      .qty-display {
        font-size: 20px;
        font-weight: 600;
        min-width: 40px;
        text-align: center;
      }

      .add-to-cart-btn {
        width: 100%;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 16px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .add-to-cart-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .add-to-cart-btn:active {
        transform: translateY(0);
      }

      /* Cart Screen */
      .cart-content {
        padding-bottom: 200px;
      }

      .cart-items {
        padding: 20px;
      }

      /* adjusted cart-item styling to be more robust */
      .cart-item {
        background: white;
        border-radius: 15px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: var(--shadow-sm);
        display: flex;
        gap: 15px;
        align-items: flex-start;
        animation: slideIn 0.3s ease-out;
      }

      .cart-item .item-image {
        width: 64px;
        height: 64px;
        font-size: 28px;
        border-radius: 10px;
        flex-shrink: 0;
      }

      .cart-item-info {
        flex: 1;
        min-width: 0;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .cart-item-name {
        font-weight: 600;
        margin-bottom: 5px;
        color: var(--text-dark);
      }

      .cart-item-details {
        font-size: 12px;
        color: var(--text-muted);
        margin-bottom: 5px;
      }

      .cart-item-price {
        color: var(--primary-color);
        font-weight: 600;
      }

      .cart-qty-controls {
        display: flex;
        align-items: center;
        gap: 12px;
        background: var(--bg-light);
        padding: 5px;
        border-radius: 20px;
      }

      .cart-qty-btn {
        width: 30px;
        height: 30px;
        border: none;
        background: white;
        border-radius: 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
        font-weight: bold;
        color: var(--primary-color);
      }

      .cart-qty-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.1);
      }

      .remove-item-btn {
        background: none;
        border: none;
        color: var(--error-color);
        font-size: 20px;
        cursor: pointer;
        padding: 5px;
        transition: var(--transition);
      }

      .remove-item-btn:hover {
        transform: scale(1.2);
      }

      .checkout-summary {
        background: white;
        margin: 20px;
        padding: 20px;
        border-radius: 15px;
        box-shadow: var(--shadow-sm);
      }

      .promo-section {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }

      .promo-input {
        flex: 1;
        padding: 12px;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        font-size: 14px;
      }

      .promo-input:focus {
        outline: none;
        border-color: var(--primary-color);
      }

      .apply-promo-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-weight: 600;
        transition: var(--transition);
      }

      .apply-promo-btn:hover {
        background: var(--primary-dark);
      }

      .promo-applied {
        background: var(--success-color);
        color: white;
        padding: 10px 15px;
        border-radius: 10px;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .remove-promo {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 18px;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 14px;
      }

      .summary-row.discount {
        color: var(--success-color);
      }

      .summary-total {
        border-top: 2px solid #eee;
        padding-top: 12px;
        font-weight: 600;
        font-size: 18px;
        margin-top: 5px;
      }

      /* ganti aturan .checkout-btn lama dengan yang ini */
      .checkout-btn {
        position: absolute; /* dari fixed -> absolute (relatif ke .screen) */
        bottom: 100px; /* jarak dari bawah layar telepon */
        left: 50%; /* center secara horizontal */
        transform: translateX(-50%);
        width: calc(100% - 40px); /* beradaptasi dengan lebar layar telepon */
        max-width: 320px; /* batasi agar tidak terlalu lebar */
        margin: 0 auto;
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 16px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        z-index: 60; /* pastikan di atas elemen lain */
      }
      .checkout-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
      }

      .checkout-btn:disabled {
        background: var(--text-muted);
        cursor: not-allowed;
        transform: none;
      }

      /* Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(3px);
        animation: fadeIn 0.3s ease-out;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal {
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 320px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        animation: slideUp 0.3s ease-out;
        box-shadow: var(--shadow-lg);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-dark);
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-muted);
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 15px;
        transition: var(--transition);
      }

      .modal-close:hover {
        background: var(--bg-light);
      }

      .modal-body {
        margin-bottom: 20px;
        color: var(--text-light);
        line-height: 1.6;
      }

      .modal-icon {
        font-size: 48px;
        text-align: center;
        margin-bottom: 15px;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
      }

      .modal-btn {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }

      .modal-btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .modal-btn-primary:hover {
        background: var(--primary-dark);
      }

      .modal-btn-secondary {
        background: var(--bg-light);
        color: var(--text-dark);
      }

      .modal-btn-secondary:hover {
        background: #e0e0e0;
      }

      .modal-btn-danger {
        background: var(--error-color);
        color: white;
      }

      .modal-btn-danger:hover {
        background: #d32f2f;
      }

      /* Location Modal */
      .location-list {
        list-style: none;
      }

      .location-item {
        padding: 15px;
        border-bottom: 1px solid #eee;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .location-item:hover {
        background: var(--bg-light);
      }

      .location-item.active {
        background: rgba(255, 107, 53, 0.1);
        color: var(--primary-color);
        font-weight: 600;
      }

      /* Favorites Modal */
      .favorites-list {
        list-style: none;
      }

      .favorite-item {
        padding: 15px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
      }

      .favorite-item:hover {
        background: var(--bg-light);
      }

      .favorite-item-info {
        display: flex;
        gap: 10px;
        align-items: center;
        flex: 1;
      }

      .favorite-item-emoji {
        font-size: 24px;
      }

      .favorite-item-name {
        font-weight: 600;
        color: var(--text-dark);
      }

      .favorite-item-price {
        color: var(--primary-color);
        font-size: 14px;
      }

      /* Navigation */
      /* Bottom nav: posisikan relatif ke .screen (yang sudah position: relative) */
      .bottom-nav {
        position: absolute; /* penting: absolut terhadap .screen */
        left: 12px; /* beri margin kiri/kanan agar tidak menempel */
        right: 12px;
        bottom: 12px; /* jarak dari bawah layar ponsel */
        background: white;
        border-top: 1px solid #eee;
        display: flex;
        justify-content: space-between; /* agar item tersebar rapi */
        align-items: center;
        padding: 8px 12px;
        border-radius: 12px;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        z-index: 100;
        max-width: calc(100% - 24px); /* menyesuaikan dengan .screen */
        box-sizing: border-box;
      }

      /* Nav items: beri flex agar merata, tapi jangan paksa max-width besar */
      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        padding: 6px 8px;
        border-radius: 10px;
        transition: var(--transition);
        position: relative;
        flex: 1 1 0; /* berkembang merata */
        max-width: 90px; /* batasi agar tidak terlalu melebar */
        min-width: 56px;
        box-sizing: border-box;
      }

      /* ketika aktif, beri latar kecil */
      .nav-item.active {
        background: rgba(255, 107, 53, 0.08);
        color: var(--primary-color);
      }
      .nav-item:hover {
        background: rgba(255, 107, 53, 0.05);
      }

      .nav-icon {
        font-size: 22px;
      }

      .nav-label {
        font-size: 11px;
        font-weight: 500;
      }

      .cart-badge {
        position: absolute;
        top: 3px;
        right: 15px;
        background: var(--error-color);
        color: white;
        border-radius: 10px;
        min-width: 18px;
        height: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 600;
        padding: 0 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* Toast Notification */
      .toast {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: 14px;
        z-index: 2000;
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-md);
        animation: toastSlideUp 0.3s ease-out;
        max-width: 300px;
        text-align: center;
      }

      @keyframes toastSlideUp {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }

      .toast.success {
        background: var(--success-color);
      }

      .toast.error {
        background: var(--error-color);
      }

      .toast.warning {
        background: var(--warning-color);
      }

      /* Responsive adjustments */
      @media (max-width: 400px) {
        .phone-container {
          width: 100%;
          max-width: 375px;
          height: 100vh;
          border-radius: 0;
          padding: 0;
        }

        .screen {
          border-radius: 0;
        }

        .bottom-nav {
          width: 100%;
          border-radius: 0;
        }

        .checkout-btn {
          max-width: 100%;
          left: 0;
          right: 0;
        }
      }

      /* Dark Mode Support */
      @media (prefers-color-scheme: dark) {
        /* Add dark mode styles if needed */
      }

      /* Accessibility */
      *:focus-visible {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      /* Print Styles */
      @media print {
        .bottom-nav,
        .back-btn,
        .icon-btn,
        .add-btn {
          display: none;
        }
      }

      /* Skeleton Loader */
      .skeleton {
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e0e0e0 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: loading 1.5s ease-in-out infinite;
      }

      @keyframes loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      .skeleton-card {
        height: 110px;
        border-radius: 15px;
        margin-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div class="phone-container">
      <div class="screen">
        <!-- Status Bar -->
        <div class="status-bar">
          <span id="current-time">9:41</span>
          <span>‚óâ‚óâ‚óâ‚óâ‚óâ 100%</span>
        </div>
        <!-- Splash Screen -->
        <div class="page active" id="splash">
          <div class="splash">
            <button
              class="skip-btn"
              onclick="showPage('home')"
              aria-label="Skip intro"
            >
              Skip
            </button>
            <div class="logo" role="img" aria-label="Bakar MantApp Logo">
              üî•
            </div>
            <h1 class="app-title">Bakar MantApp</h1>
            <p class="tagline">Nasi Bakar Asli Indonesia</p>
            <button
              class="get-started-btn"
              onclick="showPage('home')"
              aria-label="Start ordering"
            >
              Mulai Pesan
            </button>
          </div>
        </div>

        <!-- Home Screen -->
        <div class="page" id="home">
          <div class="home-header">
            <div class="header-top">
              <div
                class="location"
                onclick="openLocationModal()"
                role="button"
                tabindex="0"
                aria-label="Change location"
              >
                <span id="current-location">Jakarta Selatan</span>
              </div>
              <div class="header-icons">
                <button
                  class="icon-btn"
                  onclick="openFavoritesModal()"
                  aria-label="View favorites"
                >
                  ‚ù§Ô∏è
                </button>
                <button
                  class="icon-btn"
                  onclick="showPage('cart')"
                  aria-label="View cart"
                >
                  üõí
                  <span class="cart-badge" id="cart-count" aria-live="polite"
                    >0</span
                  >
                </button>
              </div>
            </div>
            <h2 class="welcome-text" id="greeting">Selamat Datang!</h2>
            <p class="subtitle">Pilih nasi bakar favoritmu</p>
          </div>

          <div class="search-bar">
            <span class="search-icon" aria-hidden="true">üîç</span>
            <input
              type="search"
              class="search-input"
              id="search-input"
              placeholder="Cari menu favorit..."
              aria-label="Search menu items"
              autocomplete="off"
            />
            <button
              class="clear-search"
              id="clear-search"
              onclick="clearSearch()"
              aria-label="Clear search"
            >
              √ó
            </button>
          </div>

          <div class="quick-actions">
            <h3 class="section-title">
              Menu Populer
              <span
                class="view-all"
                onclick="showPage('menu')"
                role="button"
                tabindex="0"
                >Lihat Semua ‚Üí</span
              >
            </h3>
            <div class="action-grid">
              <div
                class="action-card"
                onclick="filterAndShowMenu('all')"
                role="button"
                tabindex="0"
              >
                <div class="action-icon">üçö</div>
                <div class="action-title">Nasi Bakar</div>
                <div class="action-subtitle">15+ pilihan</div>
              </div>
              <div
                class="action-card"
                onclick="showComingSoon('Minuman')"
                role="button"
                tabindex="0"
              >
                <div class="action-icon">ü•§</div>
                <div class="action-title">Minuman</div>
                <div class="action-subtitle">Segera hadir</div>
              </div>
              <div
                class="action-card"
                onclick="showPromotions()"
                role="button"
                tabindex="0"
              >
                <div class="action-icon">üéØ</div>
                <div class="action-title">Promo</div>
                <div class="action-subtitle">Diskon 20%</div>
              </div>
              <div
                class="action-card"
                onclick="showComingSoon('Poin')"
                role="button"
                tabindex="0"
              >
                <div class="action-icon">‚≠ê</div>
                <div class="action-title">Poin Saya</div>
                <div class="action-subtitle">Kumpulkan poin</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Menu Screen -->
        <div class="page" id="menu">
          <div class="menu-header">
            <button
              class="back-btn"
              onclick="showPage('home')"
              aria-label="Back to home"
            >
              ‚Üê
            </button>
            <h2 class="menu-title">Menu Nasi Bakar</h2>
          </div>

          <div class="menu-categories" role="tablist">
            <button
              class="category-btn active"
              data-category="all"
              onclick="filterMenu('all')"
              role="tab"
              aria-selected="true"
            >
              Semua
            </button>
            <button
              class="category-btn"
              data-category="ayam"
              onclick="filterMenu('ayam')"
              role="tab"
              aria-selected="false"
            >
              Ayam
            </button>
            <button
              class="category-btn"
              data-category="seafood"
              onclick="filterMenu('seafood')"
              role="tab"
              aria-selected="false"
            >
              Seafood
            </button>
            <button
              class="category-btn"
              data-category="paket"
              onclick="filterMenu('paket')"
              role="tab"
              aria-selected="false"
            >
              Paket
            </button>
          </div>

          <div class="menu-items" id="menu-items-list" role="list">
            <!-- Menu items will be dynamically generated -->
          </div>
        </div>

        <!-- Product Detail Screen -->
        <div class="page" id="product-detail">
          <div class="product-detail">
            <div class="product-image-container">
              <button
                class="back-btn-detail"
                onclick="showPage('menu')"
                aria-label="Back to menu"
              >
                ‚Üê
              </button>
              <button
                class="favorite-btn-detail"
                id="favorite-btn-detail"
                onclick="toggleFavoriteDetail()"
                aria-label="Add to favorites"
              >
                ü§ç
              </button>
              <div
                class="product-image-large"
                id="product-emoji"
                role="img"
                aria-label="Product image"
              >
                üçó
              </div>
            </div>

            <div class="product-info">
              <div class="product-header">
                <h2 class="product-name" id="product-title">Nasi Bakar Ayam</h2>
              </div>

              <div class="product-rating" aria-label="Rating">
                <span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                <span class="rating-text">(4.8 dari 150 ulasan)</span>
              </div>

              <div class="product-price" id="product-price">Rp 25.000</div>

              <div class="product-tags" aria-label="Product tags">
                <span class="tag">üî• Terlaris</span>
                <span class="tag">‚ö° Siap 15 menit</span>
                <span class="tag">ü•á Best Seller</span>
              </div>

              <p class="product-description" id="product-desc">
                Nasi yang dimasak dengan santan kelapa kemudian dibakar dengan
                daun pisang hingga harum. Disajikan dengan potongan ayam yang
                telah dibumbui dengan kecap manis, bawang merah, bawang putih,
                dan cabai. Dilengkapi dengan sambal terasi dan kerupuk.
              </p>

              <div class="customization">
                <h4 class="custom-title">Level Kepedasan</h4>
                <div
                  class="spice-options"
                  role="radiogroup"
                  aria-label="Spice level"
                >
                  <div
                    class="spice-option selected"
                    onclick="selectSpice(this)"
                    role="radio"
                    aria-checked="true"
                    tabindex="0"
                  >
                    Tidak Pedas
                  </div>
                  <div
                    class="spice-option"
                    onclick="selectSpice(this)"
                    role="radio"
                    aria-checked="false"
                    tabindex="0"
                  >
                    Sedang
                  </div>
                  <div
                    class="spice-option"
                    onclick="selectSpice(this)"
                    role="radio"
                    aria-checked="false"
                    tabindex="0"
                  >
                    Pedas
                  </div>
                  <div
                    class="spice-option"
                    onclick="selectSpice(this)"
                    role="radio"
                    aria-checked="false"
                    tabindex="0"
                  >
                    Extra Pedas
                  </div>
                </div>
              </div>

              <div
                class="quantity-selector"
                role="group"
                aria-label="Quantity selector"
              >
                <button
                  class="qty-btn"
                  onclick="changeQuantity(-1)"
                  aria-label="Decrease quantity"
                  id="qty-minus"
                >
                  ‚àí
                </button>
                <span class="qty-display" id="quantity" aria-live="polite"
                  >1</span
                >
                <button
                  class="qty-btn"
                  onclick="changeQuantity(1)"
                  aria-label="Increase quantity"
                  id="qty-plus"
                >
                  +
                </button>
              </div>

              <button
                class="add-to-cart-btn"
                onclick="addToCartFromDetail()"
                aria-label="Add to cart"
              >
                <span>Tambah ke Keranjang</span>
                <span id="total-price">Rp 25.000</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Cart Screen -->
        <div class="page" id="cart">
          <div class="menu-header">
            <button
              class="back-btn"
              onclick="showPage('home')"
              aria-label="Back to home"
            >
              ‚Üê
            </button>
            <h2 class="menu-title">Keranjang Belanja</h2>
          </div>

          <div class="cart-content">
            <div class="cart-items" id="cart-items-container" role="list">
              <!-- Cart items will be dynamically added here -->
            </div>

            <div class="checkout-summary" id="checkout-summary">
              <div class="promo-section">
                <input
                  type="text"
                  class="promo-input"
                  id="promo-input"
                  placeholder="Masukkan kode promo"
                  aria-label="Promo code"
                />
                <button
                  class="apply-promo-btn"
                  onclick="applyPromoCode()"
                  aria-label="Apply promo code"
                >
                  Pakai
                </button>
              </div>

              <div id="promo-applied-container"></div>

              <div class="summary-row">
                <span>Subtotal</span>
                <span id="subtotal">Rp 0</span>
              </div>
              <div class="summary-row" id="discount-row" style="display: none">
                <span>Diskon</span>
                <span id="discount" class="discount">Rp 0</span>
              </div>
              <div class="summary-row">
                <span>Pajak (10%)</span>
                <span id="tax">Rp 0</span>
              </div>
              <div class="summary-row">
                <span>Ongkir</span>
                <span id="delivery-fee">Rp 10.000</span>
              </div>
              <div class="summary-row summary-total">
                <span>Total</span>
                <span id="total">Rp 0</span>
              </div>
            </div>

            <button
              class="checkout-btn"
              id="checkout-button"
              onclick="proceedToCheckout()"
              aria-label="Proceed to payment"
            >
              Lanjut ke Pembayaran
            </button>
          </div>
        </div>

        <!-- Modals -->
        <div
          class="modal-overlay"
          id="modal-overlay"
          onclick="closeModalOnOverlay(event)"
        >
          <div class="modal" id="modal-content" role="dialog" aria-modal="true">
            <!-- Modal content will be dynamically inserted -->
          </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" role="navigation" aria-label="Main navigation">
          <div
            class="nav-item active"
            onclick="showPage('home'); setActiveNav(this)"
            role="button"
            tabindex="0"
            aria-label="Home"
          >
            <span class="nav-icon">üè†</span>
            <span class="nav-label">Home</span>
          </div>
          <div
            class="nav-item"
            onclick="showPage('menu'); setActiveNav(this)"
            role="button"
            tabindex="0"
            aria-label="Menu"
          >
            <span class="nav-icon">üìã</span>
            <span class="nav-label">Menu</span>
          </div>
          <div
            class="nav-item"
            onclick="showPage('cart'); setActiveNav(this)"
            role="button"
            tabindex="0"
            aria-label="Cart"
          >
            <span class="nav-icon">üõí</span>
            <span class="nav-label">Keranjang</span>
            <span class="cart-badge" id="nav-cart-count" aria-live="polite"
              >0</span
            >
          </div>
          <div
            class="nav-item"
            onclick="showComingSoon('Profil')"
            role="button"
            tabindex="0"
            aria-label="Profile"
          >
            <span class="nav-icon">üë§</span>
            <span class="nav-label">Profil</span>
          </div>
        </nav>
      </div>
    </div>

    <script>
      // ===== GLOBAL STATE =====
      let cart = [];
      let favorites = new Set();
      let currentQuantity = 1;
      let currentPrice = 25000;
      let currentProduct = null;
      let currentLocation = "Jakarta Selatan";
      let appliedPromo = null;
      let appliedPromoCode = null;
      let maxQuantityPerItem = 20;

      // ===== PRODUCT DATABASE =====
      const products = {
        ayam: {
          id: "ayam",
          name: "Nasi Bakar Ayam",
          price: 25000,
          emoji: "üçó",
          category: "ayam",
          description:
            "Nasi yang dimasak dengan santan kelapa kemudian dibakar dengan daun pisang hingga harum. Disajikan dengan potongan ayam yang telah dibumbui dengan kecap manis, bawang merah, bawang putih, dan cabai. Dilengkapi dengan sambal terasi dan kerupuk.",
          spiceLevel: 3,
          rating: 4.8,
          reviews: 150,
          preparationTime: 15,
        },
        cumi: {
          id: "cumi",
          name: "Nasi Bakar Cumi",
          price: 28000,
          emoji: "ü¶ë",
          category: "seafood",
          description:
            "Nasi bakar dengan cumi segar yang dimasak dengan bumbu rica-rica pedas manis khas Manado. Tekstur cumi yang kenyal berpadu dengan nasi yang gurih dan harum daun pisang.",
          spiceLevel: 4,
          rating: 4.7,
          reviews: 120,
          preparationTime: 20,
        },
        tuna: {
          id: "tuna",
          name: "Nasi Bakar Tuna",
          price: 30000,
          emoji: "üêü",
          category: "seafood",
          description:
            "Nasi bakar dengan ikan tuna segar yang dimasak dengan bumbu woku khas Manado. Rasa segar ikan tuna berpadu dengan rempah-rempah tradisional yang kaya cita rasa.",
          spiceLevel: 2,
          rating: 4.9,
          reviews: 200,
          preparationTime: 18,
        },
        teri: {
          id: "teri",
          name: "Nasi Bakar Teri",
          price: 22000,
          emoji: "üê†",
          category: "ayam",
          description:
            "Nasi bakar dengan teri medan yang digoreng crispy dan dibumbui balado. Dilengkapi dengan kerupuk dan sambal terasi. Pilihan ekonomis dengan rasa yang tidak kalah lezat.",
          spiceLevel: 2,
          rating: 4.6,
          reviews: 95,
          preparationTime: 12,
        },
        udang: {
          id: "udang",
          name: "Nasi Bakar Udang",
          price: 32000,
          emoji: "ü¶ê",
          category: "seafood",
          description:
            "Nasi bakar dengan udang segar ukuran jumbo yang dimasak dengan bumbu spesial. Udang yang manis dan segar berpadu sempurna dengan nasi bakar yang gurih.",
          spiceLevel: 3,
          rating: 4.8,
          reviews: 180,
          preparationTime: 20,
        },
        paket1: {
          id: "paket1",
          name: "Paket Hemat Ayam",
          price: 35000,
          emoji: "üç±",
          category: "paket",
          description:
            "Paket hemat berisi Nasi Bakar Ayam, minuman es teh manis, dan kerupuk. Cocok untuk makan siang atau malam yang praktis dan mengenyangkan.",
          spiceLevel: 2,
          rating: 4.7,
          reviews: 130,
          preparationTime: 15,
        },
        paket2: {
          id: "paket2",
          name: "Paket Seafood Special",
          price: 50000,
          emoji: "üéÅ",
          category: "paket",
          description:
            "Paket spesial dengan Nasi Bakar Udang dan Cumi, lengkap dengan minuman dan kerupuk. Pilihan terbaik untuk pecinta seafood.",
          spiceLevel: 4,
          rating: 4.9,
          reviews: 85,
          preparationTime: 25,
        },
        bebek: {
          id: "bebek",
          name: "Nasi Bakar Bebek",
          price: 35000,
          emoji: "ü¶Ü",
          category: "ayam",
          description:
            "Nasi bakar dengan bebek goreng crispy yang empuk dan gurih. Bumbu meresap sempurna dengan tekstur yang renyah di luar dan lembut di dalam.",
          spiceLevel: 3,
          rating: 4.8,
          reviews: 110,
          preparationTime: 30,
        },
      };

      // ===== PROMO CODES =====
      const promoCodes = {
        BAKAR20: { discount: 0.2, description: "Diskon 20%" },
        MANTAP15: { discount: 0.15, description: "Diskon 15%" },
        NEWUSER: {
          discount: 0.25,
          description: "Diskon 25% untuk pengguna baru",
        },
        GRATIS: {
          discount: 0,
          freeDelivery: true,
          description: "Gratis ongkir",
        },
      };

      // ===== LOCATIONS =====
      const locations = [
        "Jakarta Pusat",
        "Jakarta Selatan",
        "Jakarta Utara",
        "Jakarta Timur",
        "Jakarta Barat",
        "Tangerang",
        "Bekasi",
        "Depok",
        "Bogor",
      ];

      // ===== INITIALIZATION =====
      document.addEventListener("DOMContentLoaded", function () {
        // Load saved data
        loadFromLocalStorage();

        // Update time
        updateCurrentTime();
        setInterval(updateCurrentTime, 60000);

        // Update greeting
        updateGreeting();

        // Generate menu items
        generateMenuItems();

        // Setup search
        setupSearch();

        // Setup keyboard navigation
        setupKeyboardNavigation();

        // Initialize cart display
        updateCartCount();
        updateCartDisplay();

        // Restore applied promo UI if any
        renderAppliedPromoUI();

        // Auto-advance from splash (optional, can be removed)
        // setTimeout(() => showPage('home'), 2000);
      });

      // ===== LOCAL STORAGE =====
      function saveToLocalStorage() {
        try {
          localStorage.setItem("cart", JSON.stringify(cart));
          localStorage.setItem("favorites", JSON.stringify([...favorites]));
          localStorage.setItem("currentLocation", currentLocation);
          localStorage.setItem("appliedPromoCode", appliedPromoCode || "");
        } catch (e) {
          console.error("Error saving to localStorage:", e);
        }
      }

      function loadFromLocalStorage() {
        try {
          const savedCart = localStorage.getItem("cart");
          if (savedCart) {
            cart = JSON.parse(savedCart);
          }

          const savedFavorites = localStorage.getItem("favorites");
          if (savedFavorites) {
            favorites = new Set(JSON.parse(savedFavorites));
          }

          const savedLocation = localStorage.getItem("currentLocation");
          if (savedLocation) {
            currentLocation = savedLocation;
            document.getElementById("current-location").textContent =
              currentLocation;
          }

          const savedPromoCode = localStorage.getItem("appliedPromoCode");
          if (savedPromoCode) {
            appliedPromoCode = savedPromoCode || null;
            if (appliedPromoCode && promoCodes[appliedPromoCode]) {
              appliedPromo = promoCodes[appliedPromoCode];
            } else {
              appliedPromo = null;
              appliedPromoCode = null;
            }
          }

          // Normalize cart (important to avoid undefined / NaN if stored format changed)
          normalizeCart();
        } catch (e) {
          console.error("Error loading from localStorage:", e);
        }
      }

      // Ensure each cart item has expected fields and types
      function normalizeCart() {
        if (!Array.isArray(cart)) cart = [];
        cart = cart.map((item) => {
          const prod = products[item && item.id] || {};
          const price = Number(item && item.price);
          const quantity = Number(item && item.quantity);
          return {
            id: item && item.id ? item.id : prod.id || "unknown",
            name: item && item.name ? item.name : prod.name || "Produk",
            price:
              Number.isFinite(price) && price > 0 ? price : prod.price || 0,
            quantity:
              Number.isFinite(quantity) && quantity > 0
                ? Math.floor(quantity)
                : 1,
            emoji: item && item.emoji ? item.emoji : prod.emoji || "üçΩÔ∏è",
            spiceLevel: item && item.spiceLevel ? item.spiceLevel : "Default",
          };
        });
      }

      // ===== UTILITY FUNCTIONS =====
      function updateCurrentTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        document.getElementById(
          "current-time"
        ).textContent = `${hours}:${minutes}`;
      }

      function updateGreeting() {
        const hour = new Date().getHours();
        let greeting = "Selamat Datang!";
        if (hour >= 5 && hour < 12) {
          greeting = "Selamat Pagi!";
        } else if (hour >= 12 && hour < 15) {
          greeting = "Selamat Siang!";
        } else if (hour >= 15 && hour < 18) {
          greeting = "Selamat Sore!";
        } else {
          greeting = "Selamat Malam!";
        }

        document.getElementById("greeting").textContent = greeting;
      }

      function formatPrice(price) {
        return "Rp " + Number(price).toLocaleString("id-ID");
      }

      function getSpiceEmoji(level) {
        return "üå∂Ô∏è".repeat(level);
      }

      // ===== PAGE NAVIGATION =====
      function showPage(pageId) {
        // Hide all pages
        const pages = document.querySelectorAll(".page");
        pages.forEach((page) => page.classList.remove("active"));

        // Show target page
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.add("active");

          // Scroll to top
          targetPage.scrollTop = 0;

          // Update based on page
          if (pageId === "cart") {
            updateCartDisplay();
          } else if (pageId === "menu") {
            // Ensure menu items are visible
            const activeCategory = document.querySelector(
              ".category-btn.active"
            );
            if (activeCategory) {
              filterMenu(activeCategory.dataset.category);
            }
          }
        }
      }

      function setActiveNav(element) {
        document
          .querySelectorAll(".nav-item")
          .forEach((item) => item.classList.remove("active"));
        element.classList.add("active");
      }

      // ===== MENU GENERATION =====
      function generateMenuItems() {
        const container = document.getElementById("menu-items-list");
        container.innerHTML = "";

        Object.values(products).forEach((product) => {
          const isFavorite = favorites.has(product.id);
          const item = document.createElement("div");
          item.className = "menu-item";
          item.dataset.category = product.category;
          item.dataset.productId = product.id;
          item.setAttribute("role", "listitem");
          item.onclick = () => showProductDetail(product.id);

          item.innerHTML = `
                <div class="item-image" role="img" aria-label="${
                  product.name
                }">${product.emoji}</div>
                <div class="item-info">
                    <div class="item-header">
                        <h4 class="item-name">${product.name}</h4>
                        <button 
                            class="favorite-btn" 
                            onclick="event.stopPropagation(); toggleFavorite('${
                              product.id
                            }')"
                            aria-label="${
                              isFavorite
                                ? "Hapus dari favorit"
                                : "Tambah ke favorit"
                            }"
                        >
                            ${isFavorite ? "‚ù§Ô∏è" : "ü§ç"}
                        </button>
                    </div>
                    <div class="spice-level" aria-label="Spice level ${
                      product.spiceLevel
                    }">
                        <span class="chili">${getSpiceEmoji(
                          product.spiceLevel
                        )}</span>
                    </div>
                    <p class="item-description">${product.description}</p>
                    <div class="item-footer">
                        <div class="item-price">${formatPrice(
                          product.price
                        )}</div>
                        <button 
                            class="add-btn" 
                            onclick="event.stopPropagation(); addToCart('${
                              product.id
                            }')"
                            aria-label="Add ${product.name} to cart"
                        >+</button>
                    </div>
                </div>
            `;

          container.appendChild(item);
        });
      }

      // ===== SEARCH FUNCTIONALITY =====
      function setupSearch() {
        const searchInput = document.getElementById("search-input");
        const clearBtn = document.getElementById("clear-search");

        searchInput.addEventListener("input", function (e) {
          const query = e.target.value.trim().toLowerCase();

          // Show/hide clear button
          clearBtn.classList.toggle("active", query.length > 0);

          // Filter menu items
          const menuItems = document.querySelectorAll(".menu-item");
          menuItems.forEach((item) => {
            const productId = item.dataset.productId;
            const product = products[productId];
            const matchesSearch =
              product.name.toLowerCase().includes(query) ||
              product.description.toLowerCase().includes(query);

            item.classList.toggle("hidden", !matchesSearch);
          });

          // Show empty state if no results
          checkEmptyState();
        });
      }

      function clearSearch() {
        const searchInput = document.getElementById("search-input");
        searchInput.value = "";
        document.getElementById("clear-search").classList.remove("active");

        // Show all items
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.classList.remove("hidden");
        });

        checkEmptyState();
      }

      function checkEmptyState() {
        const container = document.getElementById("menu-items-list");
        const visibleItems = container.querySelectorAll(
          ".menu-item:not(.hidden)"
        );

        // Remove existing empty state
        const existingEmptyState = container.querySelector(".empty-state");
        if (existingEmptyState) {
          existingEmptyState.remove();
        }

        if (visibleItems.length === 0) {
          const emptyState = document.createElement("div");
          emptyState.className = "empty-state";
          emptyState.innerHTML = `
                <div class="empty-icon">üîç</div>
                <h3 class="empty-title">Tidak Ada Hasil</h3>
                <p class="empty-message">Coba kata kunci lain atau lihat semua menu kami</p>
                <button onclick="clearSearch(); filterMenu('all')" class="modal-btn modal-btn-primary" style="max-width: 200px; margin: 0 auto;">
                    Lihat Semua Menu
                </button>
            `;
          container.appendChild(emptyState);
        }
      }

      // ===== FILTER FUNCTIONALITY =====
      function filterMenu(category) {
        // Update active button
        document.querySelectorAll(".category-btn").forEach((btn) => {
          btn.classList.remove("active");
          btn.setAttribute("aria-selected", "false");
          if (btn.dataset.category === category) {
            btn.classList.add("active");
            btn.setAttribute("aria-selected", "true");
          }
        });

        // Clear search
        clearSearch();

        // Filter items
        const menuItems = document.querySelectorAll(".menu-item");
        menuItems.forEach((item) => {
          const itemCategory = item.dataset.category;
          const shouldShow = category === "all" || itemCategory === category;
          item.classList.toggle("hidden", !shouldShow);
        });

        checkEmptyState();
      }

      function filterAndShowMenu(category) {
        showPage("menu");
        setTimeout(() => filterMenu(category), 100);
      }

      // ===== PRODUCT DETAIL =====
      function showProductDetail(productId) {
        const product = products[productId];
        if (!product) return;

        currentProduct = product;
        currentPrice = product.price;
        currentQuantity = 1;

        // Update UI
        document.getElementById("product-emoji").textContent = product.emoji;
        document.getElementById("product-title").textContent = product.name;
        document.getElementById("product-price").textContent = formatPrice(
          product.price
        );
        document.getElementById("product-desc").textContent =
          product.description;
        document.getElementById("quantity").textContent = "1";
        document.getElementById("total-price").textContent = formatPrice(
          product.price
        );

        // Update favorite button
        const favBtn = document.getElementById("favorite-btn-detail");
        favBtn.textContent = favorites.has(product.id) ? "‚ù§Ô∏è" : "ü§ç";
        favBtn.setAttribute(
          "aria-label",
          favorites.has(product.id) ? "Hapus dari favorit" : "Tambah ke favorit"
        );

        // Update rating
        const ratingEl = document.querySelector(".product-rating .rating-text");
        ratingEl.textContent = `(${product.rating} dari ${product.reviews} ulasan)`;

        // Update tags
        const tagsContainer = document.querySelector(".product-tags");
        tagsContainer.innerHTML = `
            <span class="tag">üî• Terlaris</span>
            <span class="tag">‚ö° Siap ${product.preparationTime} menit</span>
            ${
              product.rating >= 4.8
                ? '<span class="tag">ü•á Best Seller</span>'
                : ""
            }
            ${
              product.spiceLevel >= 4
                ? '<span class="tag">üå∂Ô∏è Extra Pedas</span>'
                : ""
            }
        `;

        // Reset spice selection
        const spiceOptions = document.querySelectorAll(".spice-option");
        spiceOptions.forEach((option, index) => {
          option.classList.toggle("selected", index === 0);
          option.setAttribute("aria-checked", index === 0 ? "true" : "false");
        });

        // Update quantity buttons
        updateQuantityButtons();

        showPage("product-detail");
      }

      function selectSpice(element) {
        document.querySelectorAll(".spice-option").forEach((el) => {
          el.classList.remove("selected");
          el.setAttribute("aria-checked", "false");
        });
        element.classList.add("selected");
        element.setAttribute("aria-checked", "true");
      }

      function changeQuantity(change) {
        const newQuantity = currentQuantity + change;

        if (newQuantity >= 1 && newQuantity <= maxQuantityPerItem) {
          currentQuantity = newQuantity;
          document.getElementById("quantity").textContent = currentQuantity;
          document.getElementById("total-price").textContent = formatPrice(
            currentPrice * currentQuantity
          );
          updateQuantityButtons();
        }
      }

      function updateQuantityButtons() {
        const minusBtn = document.getElementById("qty-minus");
        const plusBtn = document.getElementById("qty-plus");

        minusBtn.disabled = currentQuantity <= 1;
        plusBtn.disabled = currentQuantity >= maxQuantityPerItem;
      }

      // ===== CART FUNCTIONS =====
      function addToCart(productId) {
        const product = products[productId];
        if (!product) return;

        const existingItem = cart.find(
          (item) => item.id === productId && item.spiceLevel === "Default"
        );

        if (existingItem) {
          if (existingItem.quantity < maxQuantityPerItem) {
            existingItem.quantity += 1;
            showToast(`${product.name} ditambahkan ke keranjang`, "success");
          } else {
            showToast(
              `Maksimal ${maxQuantityPerItem} item per produk`,
              "warning"
            );
            return;
          }
        } else {
          cart.push({
            id: productId,
            name: product.name,
            price: product.price,
            quantity: 1,
            emoji: product.emoji,
            spiceLevel: "Default",
          });
          showToast(`${product.name} ditambahkan ke keranjang`, "success");
        }

        normalizeCart();
        updateCartCount();
        saveToLocalStorage();
        updateCartDisplay();
      }

      function addToCartFromDetail() {
        if (!currentProduct) return;

        const selectedSpice = document.querySelector(
          ".spice-option.selected"
        ).textContent;
        const existingItem = cart.find(
          (item) =>
            item.id === currentProduct.id && item.spiceLevel === selectedSpice
        );

        if (existingItem) {
          const newQuantity = existingItem.quantity + currentQuantity;
          if (newQuantity <= maxQuantityPerItem) {
            existingItem.quantity = newQuantity;
          } else {
            showToast(
              `Maksimal ${maxQuantityPerItem} item per produk`,
              "warning"
            );
            return;
          }
        } else {
          cart.push({
            id: currentProduct.id,
            name: currentProduct.name,
            price: currentProduct.price,
            quantity: currentQuantity,
            emoji: currentProduct.emoji,
            spiceLevel: selectedSpice,
          });
        }

        normalizeCart();
        updateCartCount();
        saveToLocalStorage();
        showToast(`${currentProduct.name} ditambahkan ke keranjang`, "success");
        showPage("menu");
      }

      function removeFromCart(index) {
        // validate index
        if (index < 0 || index >= cart.length) return;
        showConfirmation(
          "Hapus Item",
          `Apakah Anda yakin ingin menghapus ${cart[index].name} dari keranjang?`,
          () => {
            cart.splice(index, 1);
            normalizeCart();
            updateCartCount();
            updateCartDisplay();
            saveToLocalStorage();
            showToast("Item dihapus dari keranjang", "success");
          }
        );
      }

      function updateCartItemQuantity(index, change) {
        if (!cart[index]) return;

        const newQuantity = cart[index].quantity + change;

        if (newQuantity <= 0) {
          removeFromCart(index);
        } else if (newQuantity <= maxQuantityPerItem) {
          cart[index].quantity = newQuantity;
          normalizeCart();
          updateCartDisplay();
          updateCartCount();
          saveToLocalStorage();
        } else {
          showToast(
            `Maksimal ${maxQuantityPerItem} item per produk`,
            "warning"
          );
        }
      }

      function updateCartCount() {
        const totalItems = cart.reduce(
          (sum, item) => sum + (Number(item.quantity) || 0),
          0
        );
        const badges = document.querySelectorAll(".cart-badge");

        badges.forEach((badge) => {
          badge.textContent = totalItems;
          badge.style.display = totalItems > 0 ? "flex" : "none";
        });
      }

      // Build cart DOM (safer and avoids rendering glitches)
      function updateCartDisplay() {
        normalizeCart();
        const container = document.getElementById("cart-items-container");
        const checkoutBtn = document.getElementById("checkout-button");
        container.innerHTML = "";

        if (cart.length === 0) {
          container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">üõí</div>
                    <h3 class="empty-title">Keranjang Kosong</h3>
                    <p class="empty-message">Yuk, tambahkan menu favorit Anda!</p>
                    <button onclick="showPage('menu')" class="modal-btn modal-btn-primary" style="max-width: 200px; margin: 20px auto 0;">
                        Lihat Menu
                    </button>
                </div>
            `;

          document.getElementById("checkout-summary").style.display = "none";
          checkoutBtn.style.display = "none";
          // totals reset
          document.getElementById("subtotal").textContent = formatPrice(0);
          document.getElementById("tax").textContent = formatPrice(0);
          document.getElementById("delivery-fee").textContent = formatPrice(0);
          document.getElementById("total").textContent = formatPrice(0);
          return;
        }

        document.getElementById("checkout-summary").style.display = "block";
        checkoutBtn.style.display = "block";

        let subtotal = 0;

        cart.forEach((item, index) => {
          // safety fallbacks
          const price =
            Number(item.price) ||
            (products[item.id] ? products[item.id].price : 0);
          const quantity = Number(item.quantity) || 1;
          const spice = item.spiceLevel || "Default";
          const emoji =
            item.emoji || (products[item.id] ? products[item.id].emoji : "üçΩÔ∏è");

          const itemTotal = price * quantity;
          subtotal += itemTotal;

          // build DOM nodes
          const cartItemEl = document.createElement("div");
          cartItemEl.className = "cart-item";
          cartItemEl.setAttribute("role", "listitem");

          const imgEl = document.createElement("div");
          imgEl.className = "item-image";
          imgEl.textContent = emoji;

          const infoEl = document.createElement("div");
          infoEl.className = "cart-item-info";

          const nameEl = document.createElement("div");
          nameEl.className = "cart-item-name";
          nameEl.textContent = item.name;

          const detailsEl = document.createElement("div");
          detailsEl.className = "cart-item-details";
          detailsEl.textContent = `Level: ${spice}`;

          const priceEl = document.createElement("div");
          priceEl.className = "cart-item-price";
          priceEl.textContent = `${formatPrice(
            price
          )} √ó ${quantity} = ${formatPrice(itemTotal)}`;

          infoEl.appendChild(nameEl);
          infoEl.appendChild(detailsEl);
          infoEl.appendChild(priceEl);

          const controlsWrap = document.createElement("div");
          controlsWrap.style.display = "flex";
          controlsWrap.style.flexDirection = "column";
          controlsWrap.style.justifyContent = "space-between";
          controlsWrap.style.alignItems = "center";
          controlsWrap.style.gap = "10px";

          const qtyControls = document.createElement("div");
          qtyControls.className = "cart-qty-controls";
          qtyControls.setAttribute("role", "group");
          qtyControls.setAttribute("aria-label", "Quantity controls");

          const minusBtn = document.createElement("button");
          minusBtn.className = "cart-qty-btn";
          minusBtn.textContent = "‚àí";
          minusBtn.title = "Kurangi jumlah";
          minusBtn.addEventListener("click", () =>
            updateCartItemQuantity(index, -1)
          );

          const qtyDisplay = document.createElement("span");
          qtyDisplay.setAttribute("aria-live", "polite");
          qtyDisplay.textContent = quantity;

          const plusBtn = document.createElement("button");
          plusBtn.className = "cart-qty-btn";
          plusBtn.textContent = "+";
          plusBtn.title = "Tambah jumlah";
          plusBtn.addEventListener("click", () =>
            updateCartItemQuantity(index, 1)
          );

          qtyControls.appendChild(minusBtn);
          qtyControls.appendChild(qtyDisplay);
          qtyControls.appendChild(plusBtn);

          const removeBtn = document.createElement("button");
          removeBtn.className = "remove-item-btn";
          removeBtn.title = "Hapus item";
          removeBtn.innerHTML = "üóëÔ∏è";
          removeBtn.addEventListener("click", () => removeFromCart(index));

          controlsWrap.appendChild(qtyControls);
          controlsWrap.appendChild(removeBtn);

          cartItemEl.appendChild(imgEl);
          cartItemEl.appendChild(infoEl);
          cartItemEl.appendChild(controlsWrap);

          container.appendChild(cartItemEl);
        });

        // Calculate totals
        let discount = 0;
        let deliveryFee = 10000;

        if (appliedPromo) {
          if (appliedPromo.discount) {
            discount = Math.round(subtotal * appliedPromo.discount);
          }
          if (appliedPromo.freeDelivery) {
            deliveryFee = 0;
          }
        }

        const tax = Math.round((subtotal - discount) * 0.1);
        const total = subtotal - discount + tax + deliveryFee;

        // Update summary
        document.getElementById("subtotal").textContent = formatPrice(subtotal);
        document.getElementById("tax").textContent = formatPrice(tax);
        document.getElementById("delivery-fee").textContent =
          deliveryFee === 0 ? "GRATIS" : formatPrice(deliveryFee);
        document.getElementById("total").textContent = formatPrice(total);

        const discountRow = document.getElementById("discount-row");
        if (discount > 0) {
          discountRow.style.display = "flex";
          document.getElementById("discount").textContent =
            "- " + formatPrice(discount);
        } else {
          discountRow.style.display = "none";
        }
      }

      // ===== PROMO CODE =====
      function applyPromoCode() {
        const input = document.getElementById("promo-input");
        const code = input.value.trim().toUpperCase();

        if (!code) {
          showToast("Masukkan kode promo", "warning");
          return;
        }

        if (appliedPromo) {
          showToast("Hanya bisa menggunakan 1 promo", "warning");
          return;
        }

        const promo = promoCodes[code];
        if (promo) {
          appliedPromo = promo;
          appliedPromoCode = code;
          input.value = "";

          renderAppliedPromoUI();
          updateCartDisplay();
          showToast("Promo berhasil digunakan!", "success");
          saveToLocalStorage();
        } else {
          showToast("Kode promo tidak valid", "error");
        }
      }

      function renderAppliedPromoUI() {
        const container = document.getElementById("promo-applied-container");
        container.innerHTML = "";
        if (appliedPromo) {
          const div = document.createElement("div");
          div.className = "promo-applied";
          div.innerHTML = `<span>üéâ ${appliedPromo.description}</span>`;
          const btn = document.createElement("button");
          btn.className = "remove-promo";
          btn.setAttribute("aria-label", "Remove promo");
          btn.innerHTML = "√ó";
          btn.addEventListener("click", removePromo);
          div.appendChild(btn);
          container.appendChild(div);
        }
      }

      function removePromo() {
        appliedPromo = null;
        appliedPromoCode = null;
        renderAppliedPromoUI();
        updateCartDisplay();
        showToast("Promo dihapus", "success");
        saveToLocalStorage();
      }

      // ===== FAVORITES =====
      function toggleFavorite(productId) {
        if (favorites.has(productId)) {
          favorites.delete(productId);
          showToast("Dihapus dari favorit", "success");
        } else {
          favorites.add(productId);
          showToast("Ditambahkan ke favorit", "success");
        }

        // Update UI
        const menuItem = document.querySelector(
          `.menu-item[data-product-id="${productId}"]`
        );
        if (menuItem) {
          const favBtn = menuItem.querySelector(".favorite-btn");
          favBtn.textContent = favorites.has(productId) ? "‚ù§Ô∏è" : "ü§ç";
          favBtn.setAttribute(
            "aria-label",
            favorites.has(productId)
              ? "Hapus dari favorit"
              : "Tambah ke favorit"
          );
        }

        saveToLocalStorage();
      }

      function toggleFavoriteDetail() {
        if (!currentProduct) return;
        toggleFavorite(currentProduct.id);

        // Update detail page button
        const favBtn = document.getElementById("favorite-btn-detail");
        favBtn.textContent = favorites.has(currentProduct.id) ? "‚ù§Ô∏è" : "ü§ç";
        favBtn.setAttribute(
          "aria-label",
          favorites.has(currentProduct.id)
            ? "Hapus dari favorit"
            : "Tambah ke favorit"
        );
      }

      function openFavoritesModal() {
        if (favorites.size === 0) {
          showModal(
            "Favorit",
            `<div class="empty-state">
                    <div class="empty-icon">‚ù§Ô∏è</div>
                    <h3 class="empty-title">Belum Ada Favorit</h3>
                    <p class="empty-message">Tambahkan menu favorit Anda dengan menekan ‚ù§Ô∏è</p>
                </div>`,
            [
              {
                label: "Tutup",
                action: closeModal,
                className: "modal-btn-secondary",
              },
            ]
          );
          return;
        }

        const favoritesList = [...favorites]
          .map((id) => {
            const product = products[id];
            return `
                <div class="favorite-item" onclick="closeModal(); showProductDetail('${id}')">
                    <div class="favorite-item-info">
                        <div class="favorite-item-emoji">${product.emoji}</div>
                        <div>
                            <div class="favorite-item-name">${
                              product.name
                            }</div>
                            <div class="favorite-item-price">${formatPrice(
                              product.price
                            )}</div>
                        </div>
                    </div>
                    <button 
                        onclick="event.stopPropagation(); toggleFavorite('${id}'); openFavoritesModal();"
                        class="favorite-btn"
                        aria-label="Remove from favorites"
                    >‚ùå</button>
                </div>
            `;
          })
          .join("");

        showModal(
          "Menu Favorit",
          `<ul class="favorites-list">${favoritesList}</ul>`,
          [
            {
              label: "Tutup",
              action: closeModal,
              className: "modal-btn-secondary",
            },
          ]
        );
      }

      // ===== LOCATION =====
      function openLocationModal() {
        const locationsList = locations
          .map((loc) => {
            const isActive = loc === currentLocation;
            return `
                <li class="location-item ${
                  isActive ? "active" : ""
                }" onclick="selectLocation('${loc}')">
                    <span>${isActive ? "üìç" : "üìå"}</span>
                    <span>${loc}</span>
                </li>
            `;
          })
          .join("");

        showModal(
          "Pilih Lokasi",
          `<ul class="location-list">${locationsList}</ul>`,
          [
            {
              label: "Tutup",
              action: closeModal,
              className: "modal-btn-secondary",
            },
          ]
        );
      }

      function selectLocation(location) {
        currentLocation = location;
        document.getElementById("current-location").textContent = location;
        saveToLocalStorage();
        showToast(`Lokasi diubah ke ${location}`, "success");
        closeModal();
      }

      // ===== MODALS =====
      function showModal(title, body, actions = []) {
        const overlay = document.getElementById("modal-overlay");
        const modalContent = document.getElementById("modal-content");

        // Clear existing content
        modalContent.innerHTML = "";

        // Header
        const header = document.createElement("div");
        header.className = "modal-header";
        const h3 = document.createElement("h3");
        h3.className = "modal-title";
        h3.textContent = title;
        header.appendChild(h3);

        const closeBtn = document.createElement("button");
        closeBtn.className = "modal-close";
        closeBtn.setAttribute("aria-label", "Close modal");
        closeBtn.innerHTML = "√ó";
        closeBtn.addEventListener("click", closeModal);
        header.appendChild(closeBtn);

        modalContent.appendChild(header);

        // Body
        const bodyEl = document.createElement("div");
        bodyEl.className = "modal-body";
        bodyEl.innerHTML = body;
        modalContent.appendChild(bodyEl);

        // Actions
        if (actions && actions.length > 0) {
          const actionsWrap = document.createElement("div");
          actionsWrap.className = "modal-actions";

          actions.forEach((act) => {
            const btn = document.createElement("button");
            btn.className =
              "modal-btn " + (act.className || "modal-btn-primary");
            btn.type = "button";
            btn.textContent = act.label || "OK";

            btn.addEventListener("click", function () {
              if (typeof act.action === "function") {
                try {
                  act.action(act.params);
                } catch (err) {
                  console.error("Error executing modal action function", err);
                }
              } else if (
                typeof act.action === "string" &&
                typeof window[act.action] === "function"
              ) {
                try {
                  window[act.action](act.params);
                } catch (err) {
                  console.error("Error executing modal action by name", err);
                }
              }
              closeModal();
            });

            actionsWrap.appendChild(btn);
          });

          modalContent.appendChild(actionsWrap);
        }

        overlay.classList.add("active");
        modalContent.tabIndex = -1;
        modalContent.focus();
      }

      function closeModal() {
        const overlay = document.getElementById("modal-overlay");
        overlay.classList.remove("active");
      }

      function closeModalOnOverlay(event) {
        if (event.target.id === "modal-overlay") {
          closeModal();
        }
      }

      function showConfirmation(title, message, onConfirm) {
        showModal(title, `<div class="modal-icon">‚ö†Ô∏è</div><p>${message}</p>`, [
          {
            label: "Batal",
            action: closeModal,
            className: "modal-btn-secondary",
          },
          {
            label: "Ya, Hapus",
            action: () => {
              onConfirm();
            },
            className: "modal-btn-danger",
          },
        ]);
      }

      function showComingSoon(feature) {
        showModal(
          "Segera Hadir",
          `<div class="modal-icon">üöÄ</div><p>Fitur <strong>${feature}</strong> akan segera hadir! Stay tuned untuk update terbaru.</p>`,
          [{ label: "OK", action: closeModal, className: "modal-btn-primary" }]
        );
      }

      function showPromotions() {
        const promoList = Object.entries(promoCodes)
          .map(([code, promo]) => {
            return `
                <div style="padding: 15px; border: 2px dashed var(--primary-color); border-radius: 10px; margin-bottom: 10px; background: rgba(255,107,53,0.05);">
                    <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 5px;">üéüÔ∏è ${code}</div>
                    <div style="font-size: 14px; color: var(--text-light);">${promo.description}</div>
                </div>
            `;
          })
          .join("");

        showModal(
          "Promo Tersedia",
          `<p style="margin-bottom: 15px;">Gunakan kode promo di bawah ini saat checkout:</p>${promoList}`,
          [{ label: "OK", action: closeModal, className: "modal-btn-primary" }]
        );
      }

      function proceedToCheckout() {
        if (cart.length === 0) {
          showToast("Keranjang masih kosong", "warning");
          return;
        }

        // Calculate final total
        const subtotal = cart.reduce(
          (sum, item) =>
            sum +
            (Number(item.price) ||
              (products[item.id] ? products[item.id].price : 0)) *
              (Number(item.quantity) || 1),
          0
        );
        let discount = 0;
        let deliveryFee = 10000;

        if (appliedPromo) {
          if (appliedPromo.discount) {
            discount = Math.round(subtotal * appliedPromo.discount);
          }
          if (appliedPromo.freeDelivery) {
            deliveryFee = 0;
          }
        }

        const tax = Math.round((subtotal - discount) * 0.1);
        const total = subtotal - discount + tax + deliveryFee;

        showModal(
          "Konfirmasi Pesanan",
          `
                <div class="modal-icon">üéâ</div>
                <p style="margin-bottom: 15px;">Pesanan Anda akan segera diproses</p>
                <div style="background: var(--bg-light); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Total Items:</span>
                        <strong>${cart.reduce(
                          (sum, item) => sum + (Number(item.quantity) || 0),
                          0
                        )} item</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span>Lokasi:</span>
                        <strong>${currentLocation}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid #ddd; margin-top: 10px; font-size: 18px;">
                        <span>Total Bayar:</span>
                        <strong style="color: var(--primary-color);">${formatPrice(
                          total
                        )}</strong>
                    </div>
                </div>
                <p style="font-size: 14px; color: var(--text-muted);">Metode pembayaran akan tersedia di update selanjutnya</p>
            `,
          [
            {
              label: "Batal",
              action: closeModal,
              className: "modal-btn-secondary",
            },
            {
              label: "Konfirmasi Pesanan",
              action: confirmOrder,
              className: "modal-btn-primary",
            },
          ]
        );
      }

      function confirmOrder() {
        // Simulate order processing
        closeModal();
        showLoading("Memproses pesanan...");

        setTimeout(() => {
          hideLoading();
          cart = [];
          appliedPromo = null;
          appliedPromoCode = null;
          normalizeCart();
          updateCartCount();
          saveToLocalStorage();

          showModal(
            "Pesanan Berhasil! üéâ",
            `
                    <div class="modal-icon">‚úÖ</div>
                    <p style="margin-bottom: 15px;"><strong>Terima kasih atas pesanan Anda!</strong></p>
                    <p style="font-size: 14px; color: var(--text-light); margin-bottom: 15px;">
                        Nomor pesanan: <strong>#BM${Date.now()
                          .toString()
                          .slice(-6)}</strong>
                    </p>
                    <p style="font-size: 14px; color: var(--text-light);">
                        Pesanan Anda sedang diproses dan akan diantarkan dalam 30-45 menit.
                        Anda akan menerima notifikasi saat pesanan sedang diantar.
                    </p>
                `,
            [
              {
                label: "Kembali ke Home",
                action: () => {
                  showPage("home");
                },
                className: "modal-btn-primary",
              },
            ]
          );
          updateCartDisplay();
        }, 2000);
      }
      // ===== LOADING OVERLAY =====
      function showLoading(message = "Memuat...") {
        const overlay = document.createElement("div");
        overlay.className = "loading-overlay";
        overlay.id = "loading-overlay";
        overlay.innerHTML = `
            <div class="spinner"></div>
            <div class="loading-text">${message}</div>
        `;
        document.body.appendChild(overlay);
      }

      function hideLoading() {
        const overlay = document.getElementById("loading-overlay");
        if (overlay) {
          overlay.remove();
        }
      }

      // ===== TOAST NOTIFICATIONS =====
      function showToast(message, type = "default") {
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "polite");

        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = "toastSlideUp 0.3s ease-out reverse";
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }

      // ===== KEYBOARD NAVIGATION =====
      function setupKeyboardNavigation() {
        document.addEventListener("keydown", function (e) {
          // ESC to close modal
          if (e.key === "Escape") {
            const modal = document.getElementById("modal-overlay");
            if (modal.classList.contains("active")) {
              closeModal();
            }
          }

          // Ctrl/Cmd + K for search
          if ((e.ctrlKey || e.metaKey) && e.key === "k") {
            e.preventDefault();
            const searchInput = document.getElementById("search-input");
            if (searchInput) {
              searchInput.focus();
            }
          }
        });

        // Make buttons keyboard accessible
        document.querySelectorAll('[role="button"]').forEach((el) => {
          if (!el.hasAttribute("tabindex")) {
            el.setAttribute("tabindex", "0");
          }

          el.addEventListener("keydown", function (e) {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              el.click();
            }
          });
        });
      }

      // ===== SERVICE WORKER (PWA) =====
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          // Service worker registration would go here
          // navigator.serviceWorker.register('/sw.js');
        });
      }
    </script>
  </body>
</html>
